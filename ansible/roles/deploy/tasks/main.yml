- name: Create app directory
  file:
    path: /app
    state: directory
    mode: "0755"

- name: Copy docker-compose file
  template:
    src: ../templates/docker-compose.prod.yml.j2
    dest: /app/docker-compose.yml

- name: Login to Docker Hub
  community.docker.docker_login:
    username: "{{ dockerhub_username }}"
    password: "{{ secrets.DOCKERHUB_TOKEN }}"

- name: Pull and start containers
  community.docker.docker_compose:
    project_src: /app
    state: present
    restarted: yes
    pull: yes

- name: Ensure containers are running
  community.docker.docker_compose:
    project_src: /app
    state: started
